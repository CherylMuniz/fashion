<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License (AFL 3.0)
 * that is bundled with this package in the file LICENSE_AFL.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/afl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category    design
 * @package     base_default
 * @copyright   Copyright (c) 2012 Magento Inc. (http://www.magentocommerce.com)
 * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */
?>
<?php if($this->getItems()->getSize()): ?>
<div class="block block-related" id="lenses">
    <!-- div class="block-title">
        <strong><span><em style="color:#EB340A;margin-right:5px">*</em><?php echo $this->__('PLEASE CHOOSE YOUR LENS TYPE') ?></span></strong>
    </div -->
    <div class="block-content">
        <!-- p class="block-subtitle"><?php echo $this->__('Check items to add to the cart or') ?>&nbsp;<a href="#" onclick="selectAllRelated(this); return false;"><?php echo $this->__('select all') ?></a></p -->
        <div class="mini-products-list" id="block-related">
            
            <?php $count = count($this->getItems()); $half = ceil($count/2); $i=1; ?>
            <div class="tbl" id="lensRelatedTable"><div class="tr">
        <?php foreach($this->getItems() as $_item): ?>
            <?php if ($i == 1) echo '<div class="td">'; ?>
            <span class="item">
                <?php if(!$_item->isComposite() && $_item->isSaleable()): ?>
                <input id="related_lens" type="hidden" value="<?php echo $_item->getId() ?>" name="<?php echo $_item->getSku() ?>" />
                    <?php //oberig #if (!$_item->getRequiredOptions()): ?>
                        <!-- Warning! class checkbox-1 uses for jQuery -->
                        <input style="display:none" type="checkbox" class="checkbox-1 related-checkbox" id="related-checkbox<?php echo $_item->getId() ?>" name="related_products[]" value="<?php echo $_item->getId() ?>" onClick="toggle_options(this)"/>
                    <?php //#endif; ?>
                <?php endif; ?>
<!--
                <div class="product">
-->
                    <!-- a href="<?php echo $_item->getProductUrl() ?>" title="<?php echo $this->htmlEscape($_item->getName()) ?>" class="product-image"><img src="<?php echo $this->helper('catalog/image')->init($_item, 'thumbnail')->resize(50) ?>" width="50" height="50" alt="<?php echo $this->htmlEscape($_item->getName()) ?>" /></a -->
<!--
                    <div class="product-details">
-->
                        <!-- span class="product-name"><a href="<?php echo $_item->getProductUrl() ?>"><?php echo $this->htmlEscape($_item->getName()) ?></a></span><br/ -->
                        <?php //echo $this->getPriceHtml($_item, true, '-related') ?>
                        <?php if ($this->helper('wishlist')->isAllow()) : ?>
                            <!-- a href="<?php echo $this->getAddToWishlistUrl($_item) ?>" class="link-wishlist"><?php echo $this->__('Add to Wishlist') ?></a -->
                        <?php endif; ?>
                            <span id="lens_options<?php echo $_item->getId() ?>" class="product-options" >
                            
                            <!-- lenses attributes ( use modified template from attributes.phtml) --> 
                                <span>
                                        <?php //additional information for lenses ( use modifed template from attributes.phtml)
                                            $_helper = $this->helper('catalog/output');
                                            $_product = Mage::getModel('catalog/product')->load($_item->getId());
                                            $block = new Oberig_Lens_Catalog_Block_Product_View_Attributes();
                                            $block->setProduct($_product);
                                        ?>
                                        <?php if($_additional = $block->getAdditionalData()): ?>
                                            <h2><?php echo $this->__('Additional Information') ?></h2>
                                            <table class="data-table" id="product-attribute-specs-table">
                                                <col width="25%" />
                                                <col />
                                                <tbody>
                                                <?php foreach ($_additional as $_data): ?>
                                                    <tr>
                                                        <th class="label"><?php echo $this->htmlEscape($this->__($_data['label'])) ?></th>
                                                        <td class="data <?php echo strtolower($_data['label']); ?>"><?php echo $_helper->productAttribute($_product, $_data['value'], $_data['code']) ?></td>
                                                    </tr>
                                                <?php endforeach; ?>
                                                </tbody>
                                            </table>
                                            <script type="text/javascript">decorateTable('product-attribute-specs-table')</script>
                                        <?php endif;?>
                                </span>
                                <!-- end lenses attributes --> 
                                
                            <?php // oberig 
                                $optBlock = Mage::getSingleton('core/layout')->createBlock('catalog/product_view_options');
                                $optBlock->addOptionRenderer('select', "catalog/product_view_options_type_select", "catalog/product/view/options/type/select.phtml");
                                $p =Mage::getModel('catalog/product')->load($_item->getId());
                                $optBlock->setProduct($p);
                                //$ops = $p->getOptions(); foreach($ops as $op ){ mage::d($op->getData()); } 
                                echo ($optBlock->setTemplate('catalog/product/view/options.phtml')->toHtml());
                            ?>
                            </span>

<!--
                    </div>
-->
<!--
                </div>
-->
            </span>
            <?php if($i == $count){ echo "</div>"; }?>
        <?php $i++; endforeach ?>
            </div></div>
        </div>
        <script type="text/javascript">decorateList('block-related', 'none-recursive')</script>
    </div>
</div>
<?php endif ?>
    <script type="text/javascript">
    //<![CDATA[
    $$('.related-checkbox').each(function(elem){
        Event.observe(elem, 'click', addRelatedToProduct)
    });

    var relatedProductsCheckFlag = false;
    function selectAllRelated(txt){
        if (relatedProductsCheckFlag == false) {
            $$('.related-checkbox').each(function(elem){
                elem.checked = true;
            });
            relatedProductsCheckFlag = true;
            txt.innerHTML="<?php echo $this->__('unselect all') ?>";
        } else {
            $$('.related-checkbox').each(function(elem){
                elem.checked = false;
            });
            relatedProductsCheckFlag = false;
            txt.innerHTML="<?php echo $this->__('select all') ?>";
        }
        addRelatedToProduct();
    }

    function addRelatedToProduct(){
        var checkboxes = $$('.related-checkbox');
        var values = [];
        for(var i=0;i<checkboxes.length;i++){
            if(checkboxes[i].checked) values.push(checkboxes[i].value);
        }
        if($('related-products-field')){
            $('related-products-field').value = values.join(',');
        }
    }
    
    /*function toggle_options(obj){
        //jQuery('#lens_options'+obj.value).toggle();
        jQuery('#lensOptionsTable').toggle();
        jQuery('#block-related').find('.item').each( function(key, val){
            if(val.children[0].value != obj.value){
               val.toggle();
            }
        });
    }*/
    function toggle_next_option(obj){
        jQuery('#lensOptionsTable '+ obj.id).parents('.tr').next().toggle();
    }
    function toggle_lenses(){
        jQuery('#lenses').show();
        jQuery('.btn-pscart').hide();
        //jQuery('#lensPrescriptionTable th').first().toggle();
    }
    

    // observe for change select-option and display next dropdown.
jQuery(document).ready(function(){
  jQuery('#lensOptionsTable input, #lensOptionsTable select').change(function(){
      console.log(this.id);
        jQuery('#lensOptionsTable').siblings().show();
        var lens = jQuery("#related_lens").attr('name');

        switch(lens){
            case 'lens-standard' :
                standard();
                break;
            case 'lens-rimless' :
             console.log('test');
                rimless();
                break;
            case 'lens-fullyrimmed' :
                fullyrimmed();
                break;
            case 'lens-specialty' :
                specialty();
                break;
            case 'lens-oakley' :
                oakley();
                break;
        }

      //var filter1 = jQuery('#'+this.id + " option:selected").attr('sku');

      
        //console.log(type);
        //jQuery('#lensOptionsTable').siblings().show();

      /*
        lensThickness();
        lensTint();

      var selectedOption = jQuery('#'+this.id).parents('.tr').last().attr('id');
      console.log(selectedOption);
      if( selectedOption != 'lens_type' && type != undefined ){
        jQuery('#'+this.id).parents('.tr').last().next().css('display','table-row');
        jQuery('#'+this.id).parents('.tr').last().next().find('.tbl .tr').css('display','table-row');
        //jQuery('#'+this.id).parents('.tr').last().next().find('.tbl tr').css('display','table-row');
        //jQuery('#'+this.id).parents('.tr').last().next().find('*').show();  // dont use toggle()!
         jQuery('.option_popup').hide();
      }*/
/*
      if( type == 'single' ) { jQuery('#lens_varifocal_type').hide(); }
        if( -1 == jQuery.inArray(thickness,['thickness_standard_sv','thickness_standard_bf', 'thickness_standard_vf']) ){
            jQuery('#tint_brown_photo').hide();
            jQuery('#tint_grey_photo').hide();
            console.log(thickness);
            if(tint == 'tint_brown_photo' || tint == 'tint_grey_photo') { jQuery("#lens_tint .tint_none .radio").attr('checked', true); }          // jQuery("td #lens_tint option").first().attr('selected', true);
        }else{
            console.log(thickness);
            jQuery('#tint_brown_photo').show();
            jQuery('#tint_grey_photo').show();
        }
*/
/*
        if(thickness == 'thickness_thinnest'){
            jQuery('#lens_tint').hide();
            jQuery('#lens_coating').show().find('*').show();
            jQuery("#lens_tint .tint_none .radio").attr('checked', true);
             jQuery('.option_popup').hide();
        }else{
            jQuery('input[sku=tint_brown]').parent().show();
            jQuery('input[sku=tint_grey]').parent().show();
            jQuery('.tint_brown').show();
            jQuery('.tint_grey').show();
        }
*/
/*
         if( -1 != jQuery.inArray(tint,['tint_brown_photo','tint_grey_photo']) ){
            lensCoating();
            switch(type) {
                case 'single' : jQuery('#coating_anti_sv').show(); break;
                case 'bifocal' : jQuery('#coating_anti_bf').show(); break;
                case 'varifocal' : jQuery('#coating_anti_vf').show(); break;
            }
            jQuery('#coating_premium_sv,#coating_premium_bf,#coating_premium_vf').hide();
            jQuery('#coating_elite_sv,#coating_elite_bf,#coating_elite_vf').hide();
            if( -1 != jQuery.inArray(coating,[
                'coating_premium_sv',
                'coating_premium_bf',
                'coating_premium_vf',
                'coating_elite_sv',
                'coating_elite_bf',
                'coating_elite_vf'
            ]) ) { jQuery("#lens_coating .radio").each( function(){ jQuery(this).attr('checked', false) } ); }
         }else{
            lensCoating();
         }
*/
  jQuery('.option_popup').hide();
    });
//
  jQuery('#lensOptionsTable .tr').first().css('display','table-row');


    /*jQuery('#lensPrescriptionTable select').change(function(){
          if( jQuery('#'+this.id+ ' option:checked').text() == jQuery('#'+this.id+' option[value=""]').text() ) { jQuery('#'+this.title).text(''); return; }
          jQuery('#'+this.title).text(
            jQuery('#'+this.id+ ' option:checked').text()
          );
    });*/

    if ( '1' == jQuery('#isDesignerFrames').attr('value') ){
        toggle_lenses();
    }
    
    jQuery('.i_info').mouseover(function(){
        jQuery(this).next().show();
        return;
        });
    jQuery('.i_info').mouseleave(function(){
        jQuery(this).next().hide();
        });

});

    function hide_lenses(){
        jQuery('#lens_type').siblings().hide();
        jQuery('#lensOptionsTable').siblings().hide();
        jQuery("#lensOptionsTable, #lensPrescriptionTable").find(':checked, :selected').attr('checked', false).attr('selected', false);
        jQuery("#lens_type .frame_only").attr('checked', true); 
    }
    function single_global(){
        jQuery('#lens_glasses_for').css('display','table-row');
        jQuery('#lens_varifocal_type').hide();
    }
    function bifocal_global(){
        jQuery('#lens_glasses_for').hide();
        jQuery('#lens_varifocal_type').hide();
        jQuery("#lens_thickness, #lens_thickness .tr").css('display','table-row');
    }
    function varifocal_global(){
        jQuery('#lens_glasses_for').hide();
        jQuery('#lens_varifocal_type').css('display','table-row');
    }
    
    
    function thickness_single(){
        jQuery('#thickness_standard_sv,#thickness_thin_sv,#thickness_thinner_sv,#thickness_thinnest_sv').show();
        jQuery('#thickness_standard_bf,#thickness_thin_bf,#thickness_thinner_bf,#thickness_thinnest_bf').hide();
        jQuery('#thickness_standard_vf,#thickness_thin_vf,#thickness_thinner_vf,#thickness_thinnest_vf').hide();
    }
    function thickness_bifocal(){
        jQuery('#thickness_standard_sv,#thickness_thin_sv,#thickness_thinner_sv,#thickness_thinnest_sv').hide();
        jQuery('#thickness_standard_bf,#thickness_thin_bf,#thickness_thinner_bf,#thickness_thinnest_bf').show();
        jQuery('#thickness_standard_vf,#thickness_thin_vf,#thickness_thinner_vf,#thickness_thinnest_vf').hide();
    }
    function thickness_varifocal(){
        jQuery('#thickness_standard_sv,#thickness_thin_sv,#thickness_thinner_sv,#thickness_thinnest_sv').hide();
        jQuery('#thickness_standard_bf,#thickness_thin_bf,#thickness_thinner_bf,#thickness_thinnest_bf').hide();
        jQuery('#thickness_standard_vf,#thickness_thin_vf,#thickness_thinner_vf,#thickness_thinnest_vf').show();
    }
    
    function coating_single(){
        jQuery('#coating_anti_sv,#coating_premium_sv,#coating_elite_sv,#coating_resistant_sv').show();
        jQuery('#coating_anti_bf,#coating_premium_bf,#coating_elite_bf,#coating_resistant_bf').hide();
        jQuery('#coating_anti_vf,#coating_premium_vf,#coating_elite_vf,#coating_resistant_vf,#coating_anti_vf_basic').hide();
    }
    function coating_bifocal(){
        jQuery('#coating_anti_sv,#coating_premium_sv,#coating_elite_sv,#coating_resistant_sv').hide();
        jQuery('#coating_anti_bf,#coating_premium_bf,#coating_elite_bf,#coating_resistant_bf').show();
        jQuery('#coating_anti_vf,#coating_premium_vf,#coating_elite_vf,#coating_resistant_vf,#coating_anti_vf_basic').hide();
    }
    function coating_varifocal(){
        jQuery('#coating_anti_sv,#coating_premium_sv,#coating_elite_sv,#coating_resistant_sv').hide();
        jQuery('#coating_anti_bf,#coating_premium_bf,#coating_elite_bf,#coating_resistant_bf').hide();
        jQuery('#coating_anti_vf,#coating_premium_vf,#coating_elite_vf,#coating_resistant_vf').show();
    }
    function tint_single(){
        jQuery('#tint_full_sv,#tint_iridium_sv,#tint_polarised_sv,#tint_transitions_sv').show();
        jQuery('#tint_full_vf,#tint_iridium_vf,#tint_polarised_vf,#tint_transitions_vf').hide();
    }
    function tint_varifocal(){
        jQuery('#tint_full_sv,#tint_iridium_sv,#tint_polarised_sv,#tint_transitions_sv').hide();
        jQuery('#tint_full_vf,#tint_iridium_vf,#tint_polarised_vf,#tint_transitions_vf').show();
    }
    
    function array_diff (arr1) {
      // http://kevin.vanzonneveld.net
      // +   original by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)
      // +   improved by: Sanjoy Roy
      // +    revised by: Brett Zamir (http://brett-zamir.me)
      // *     example 1: array_diff(['Kevin', 'van', 'Zonneveld'], ['van', 'Zonneveld']);
      // *     returns 1: {0:'Kevin'}
      var retArr = {},
        argl = arguments.length,
        k1 = '',
        i = 1,
        k = '',
        arr = {};

      arr1keys: for (k1 in arr1) {
        for (i = 1; i < argl; i++) {
          arr = arguments[i];
          for (k in arr) {
            if (arr[k] === arr1[k1]) {
              // If it reaches here, it was found in at least one array, so try next value
              continue arr1keys;
            }
          }
          retArr[k1] = arr1[k1];
        }
      }
      return retArr;
    }
    
    // ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ Standard ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ //
    function standard(){
        var type = jQuery("#lens_type input:checked").attr('sku');
        switch(type){
            case 'single' :
                single();
                break;
            case 'bifocal' :
                bifocal();
                break;
            case 'varifocal' :
                varifocal();
                break;
            default :
                hide_lenses();
        }
        general();
        function general(){
            var type = jQuery("#lens_type input:checked").attr('sku');
            var glasses_for = jQuery("#lens_glasses_for input:checked").attr('sku');
            var varifocal_type = jQuery("#lens_varifocal_type input:checked").attr('sku');
            var thickness = jQuery("#lens_thickness input:checked").attr('sku'); 
            var coating = jQuery("#lens_coating input:checked").attr('sku');
            var tint = jQuery("#lens_tint input:checked").attr('sku');
            var color = jQuery("#lens_color input:checked").attr('sku');
            var tint_depth = jQuery("#lens_tint_depth input:checked").attr('sku');

            if ( glasses_for || varifocal_type ){ jQuery("#lens_thickness, #lens_thickness .tr").css('display','table-row'); }
            if ( thickness ){ jQuery("#lens_tint, #lens_tint .tr").css('display','table-row'); }
            if ( tint ){ jQuery("#lens_color, #lens_color .tr").css('display','table-row'); }
            if ( color ){ jQuery("#lens_tint_depth, #lens_tint_depth .tr").css('display','table-row'); }
            if ( tint_depth ){ jQuery("#lens_coating, #lens_coating .tr").css('display','table-row'); }
            
            if(thickness == 'thickness_standard'){
                jQuery('#tint_original').show();
            }else{
                jQuery('#tint_original').hide();
            }
            if(tint == 'tint_polarised'){
                jQuery('#color_green,#tint_depth_light,#tint_depth_medium').hide();
            }else{
                jQuery('#color_green,#tint_depth_light,#tint_depth_medium').show();
            }
            if(varifocal_type == 'varifocal_basic'){
                 jQuery('#thickness_thinner_vf,#coating_elite').hide();
            }else{
                 jQuery('#thickness_thinner_vf,#coating_elite').show();
                
            }
            if( thickness == 'thickness_standard' && tint != 'tint_polarised' ){ 
                jQuery("#tint_depth_dark").show();
            }else{
                jQuery("#tint_depth_dark").hide();
            }
        }
        function bifocal(){
            bifocal_global();
            
            var type = jQuery("#lens_type input:checked").attr('sku');
            if(type == 'bifocal'){
                 jQuery('#thickness_thinner').hide();
            }else{
                 jQuery('#thickness_thinner').show();
            }
        }
        function varifocal(){
            varifocal_global();

            var varifocal_type = jQuery("#lens_varifocal_type input:checked").attr('sku');
            
            if( varifocal_type == 'varifocal_basic'){
                 jQuery('#thickness_thinner,#coating_elite').hide();
            }else{
                 jQuery('#thickness_thinner,#coating_elite').show();
                
            }
        }
        function single(){
            single_global();
        }
    }
    
    // ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ Rimless and Supra ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ //
    function rimless(){
        var type = jQuery("#lens_type input:checked").attr('sku');
        switch(type){
            case 'single' :
                single();
                break;
            case 'bifocal' :
                bifocal();
                break;
            case 'varifocal' :
                varifocal();
                break;
            default :
                hide_lenses();
        }
        general();
        function general(){
            var type = jQuery("#lens_type input:checked").attr('sku');
            var glasses_for = jQuery("#lens_glasses_for input:checked").attr('sku');
            var varifocal_type = jQuery("#lens_varifocal_type input:checked").attr('sku');
            var thickness = jQuery("#lens_thickness input:checked").attr('sku'); 
            var tint = jQuery("#lens_tint input:checked").attr('sku');
            var coating = jQuery("#lens_coating input:checked").attr('sku');

            if ( glasses_for || varifocal_type ){ jQuery("#lens_thickness, #lens_thickness .tr").css('display','table-row'); }
            if ( thickness ){ jQuery("#lens_tint, #lens_tint .tr").css('display','table-row'); }
            if ( tint ){ jQuery("#lens_coating, #lens_coating .tr").css('display','table-row'); }
            
            if( type == 'bifocal' ){ jQuery("#lens_tint, #lens_tint .tr").hide(); }
        }
        function single(){
            single_global();
            thickness_single();
            coating_single();
        }
        function bifocal(){
            bifocal_global();
            thickness_bifocal();
            coating_bifocal();
        }
        function varifocal(){
            varifocal_global();
            thickness_varifocal();
            coating_varifocal();
            var varifocal_type = jQuery("#lens_varifocal_type input:checked").attr('sku');
            if(varifocal_type == 'varifocal_basic'){
                jQuery('#thickness_thinner_vf,#thickness_thinnest_vf,  #coating_premium_vf,#coating_elite_vf').hide();
                jQuery('#thickness_thin_vf, #coating_anti_vf').find('.radio').attr('checked', true);
            }else{
                jQuery('#thickness_thinner_vf,#thickness_thinnest_vf,  #coating_premium_vf,#coating_elite_vf').show();
            }
        }
    }
    
    // ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ Specialty ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ //
    
    function specialty(){
        var type = jQuery("#lens_type input:checked").attr('sku');
        switch(type){
            case 'single' :
                single();
                break;
            case 'bifocal' :
                bifocal();
                break;
            case 'varifocal' :
                varifocal();
                break;
            default :
                hide_lenses();
        }
        general();
        function general(){
            var type = jQuery("#lens_type input:checked").attr('sku');
            var glasses_for = jQuery("#lens_glasses_for input:checked").attr('sku');
            var varifocal_type = jQuery("#lens_varifocal_type input:checked").attr('sku');
            var thickness = jQuery("#lens_thickness input:checked").attr('sku'); 
            var tint = jQuery("#lens_tint input:checked").attr('sku');
            var color = jQuery("#lens_color input:checked").attr('sku');
            var tint_depth = jQuery("#lens_tint_depth input:checked").attr('sku');
            var coating = jQuery("#lens_coating input:checked").attr('sku');

            if ( glasses_for || varifocal_type ){ jQuery("#lens_thickness, #lens_thickness .tr").css('display','table-row'); }
            if ( thickness ){ jQuery("#lens_tint, #lens_tint .tr").css('display','table-row'); }
            if ( tint ){ jQuery("#lens_color, #lens_color .tr").css('display','table-row'); }
            if ( color ){ jQuery("#lens_tint_depth, #lens_tint_depth .tr").css('display','table-row'); }
            if ( tint_depth ){ jQuery("#lens_coating, #lens_coating .tr").css('display','table-row'); }
            
            if( thickness == 'thickness_standard' ){ 
                jQuery("#tint_original").show();
            }else{
                jQuery("#tint_original").hide();
            }
            if( tint == 'tint_polarised' ){ 
                jQuery("#color_green, #tint_depth_light,#tint_depth_medium").hide();
            }else{
                jQuery("#color_green, #tint_depth_light,#tint_depth_medium").show();
            }
            if( thickness == 'thickness_standard' && tint != 'tint_polarised' ){ 
                jQuery("#tint_depth_dark").show();
            }else{
                jQuery("#tint_depth_dark").hide();
            }
        }
        function single(){
            single_global();
        }
        function bifocal(){
            bifocal_global();
        }
        function varifocal(){
            varifocal_global();
            var varifocal_type = jQuery("#lens_varifocal_type input:checked").attr('sku');
            if(varifocal_type == 'varifocal_basic'){
                jQuery('#thickness_thinner_vf,#thickness_thinnest_vf,  #coating_premium_vf,#coating_elite_vf').hide();
                jQuery('#thickness_thin_vf, #coating_anti_vf').find('.radio').attr('checked', true);
            }else{
                jQuery('#thickness_thinner_vf,#thickness_thinnest_vf,  #coating_premium_vf,#coating_elite_vf').show();
            }
        }
    }
    
    // ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ Fully Rimmed ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ //
    
    function fullyrimmed(){
        var type = jQuery("#lens_type input:checked").attr('sku');
        general();
        switch(type){
            case 'single' :
                single();
                break;
            case 'bifocal' :
                bifocal();
                break;
            case 'varifocal' :
                varifocal();
                break;
            default :
                hide_lenses();
        }
        function general(){
            var type = jQuery("#lens_type input:checked").attr('sku');
            var glasses_for = jQuery("#lens_glasses_for input:checked").attr('sku');
            var varifocal_type = jQuery("#lens_varifocal_type input:checked").attr('sku');
            var thickness = jQuery("#lens_thickness input:checked").attr('sku'); 
            var tint = jQuery("#lens_tint input:checked").attr('sku');
            var coating = jQuery("#lens_coating input:checked").attr('sku');

            if ( glasses_for || varifocal_type ){ jQuery("#lens_thickness, #lens_thickness .tr").css('display','table-row'); }
            if ( thickness ){ jQuery("#lens_tint, #lens_tint .tr").css('display','table-row'); }
            if ( tint ){ jQuery("#lens_coating, #lens_coating .tr").css('display','table-row'); }
        }
        function single(){
            single_global();
            thickness_single();
            coating_single();
            var thickness = jQuery("#lens_thickness input:checked").attr('sku');
            var coating = jQuery("#lens_coating input:checked").attr('sku');
            var tint = jQuery("#lens_tint input:checked").attr('sku');

            jQuery("#coating_anti_vf_basic").hide();
            if( thickness == 'thickness_standard_sv' && (!coating || coating == 'coating_anti_sv') ){ 
                jQuery("#tint_brown_photo, #tint_grey_photo").show();
            }else{
                jQuery("#tint_brown_photo, #tint_grey_photo").hide();
            }
            if( tint == 'tint_brown_photo' || tint == 'tint_grey_photo' ){ 
                jQuery("#coating_premium_sv, #coating_elite_sv").hide();
            }else{
                jQuery("#coating_premium_sv, #coating_elite_sv").show();
            }
        }
        function bifocal(){
            bifocal_global();
            thickness_bifocal();
            coating_bifocal();
            var thickness = jQuery("#lens_thickness input:checked").attr('sku');
            var tint = jQuery("#lens_tint input:checked").attr('sku');
            if( thickness == 'thickness_standard_bf' ){
                jQuery("#lens_tint, #lens_tint .tr").css('display','table-row');
                jQuery("#tint_brown_photo, #tint_grey_photo").hide();
            }else{
                jQuery("#lens_tint, #lens_tint .tr").hide();
            }
            if( tint == 'tint_brown' || tint == 'tint_grey' ){ 
                jQuery("#coating_resistant_bf").hide();
            }else{
                jQuery("#coating_resistant_bf").show();
            }
        }
        function varifocal(){
            varifocal_global();
            thickness_varifocal();
            coating_varifocal();
            jQuery("#coating_anti_vf_basic").hide();
            
            var thickness = jQuery("#lens_thickness input:checked").attr('sku');
            var coating = jQuery("#lens_coating input:checked").attr('sku');
            if( thickness == 'thickness_standard_vf' && (!coating || coating == 'coating_anti_vf' || coating == 'coating_anti_vf_basic') ){ 
                jQuery("#tint_brown_photo, #tint_grey_photo").show();
            }else{
                jQuery("#tint_brown_photo, #tint_grey_photo").hide();
            }
            
            var tint = jQuery("#lens_tint input:checked").attr('sku');
            if( tint == 'tint_brown_photo' || tint == 'tint_grey_photo' ){ 
                jQuery("#coating_premium_vf, #coating_elite_vf").hide();
            }else{
                jQuery("#coating_premium_vf, #coating_elite_vf").show();
            }
            
            var varifocal_type = jQuery("#lens_varifocal_type input:checked").attr('sku');
            if(varifocal_type == 'varifocal_basic'){
                jQuery('#thickness_thinner_vf,#thickness_thinnest_vf,  #coating_premium_vf,#coating_elite_vf,#coating_anti_vf').hide();
                jQuery('#coating_anti_vf_basic').show();
            }else{
                jQuery('#coating_anti_vf_basic').hide();
                jQuery('#coating_anti_vf').show();
                jQuery('#thickness_thinner_vf,#thickness_thinnest_vf,  #coating_premium_vf,#coating_elite_vf').show();
            }
            
        }
    }
    // ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ Oakley ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ //
    
    function oakley(){
        var type = jQuery("#lens_type input:checked").attr('sku');
        var colors = [
            'color_oakley_00_red_iridium',
            'color_oakley_black',
            'color_oakley_black_iridium',
            'color_oakley_black_iridium_bar',
            'color_oakley_bronze',
            'color_oakley_bronze_bar',
            'color_oakley_bronze_polarised',
            'color_oakley_brown_ar',
            'color_oakley_clear_ar',
            'color_oakley_deep_blue',
            'color_oakley_deep_blue_iridium',
            'color_oakley_emerald_iridium_bar',
            'color_oakley_fire',
            'color_oakley_g30',
            'color_oakley_g30_iridium',
            'color_oakley_gold',
            'color_oakley_gold_iridium',
            'color_oakley_gold_iridium_bar',
            'color_oakley_grey',
            'color_oakley_grey_ar',
            'color_oakley_grey_bar',
            'color_oakley_ice',
            'color_oakley_ice_iridium',
            'color_oakley_oo_black',
            'color_oakley_oo_red_iridium',
            'color_oakley_persimon',
            'color_oakley_shallow_blue',
            'color_oakley_tungsten',
            'color_oakley_vr27_black',
            'color_oakley_vr27_black_iridium',
            'color_oakley_vr28',
            'color_oakley_vr28_bar',
            'color_oakley_vr28_black_iridium',
        ];
        general();
        switch(type){
            case 'single' :
                single(colors);
                break;
            case 'varifocal' :
                varifocal(colors);
                break;
            //default :
                //hide_lenses();
        }
        function general(){
            var type = jQuery("#lens_type input:checked").attr('sku');
            var glasses_for = jQuery("#lens_glasses_for input:checked").attr('sku');
            var varifocal_type = jQuery("#lens_varifocal_type input:checked").attr('sku');
            var thickness = jQuery("#lens_thickness input:checked").attr('sku'); 
            var tint = jQuery("#lens_tint input:checked").attr('sku');

            if ( glasses_for || varifocal_type ){ jQuery("#lens_thickness, #lens_thickness .tr").css('display','table-row'); }
            if ( thickness ){ jQuery("#lens_tint, #lens_tint .tr").css('display','table-row'); }
            if ( tint ){ jQuery("#lens_color, #lens_color .tr").css('display','table-row'); }
        }
        function single(col){
            single_global();
            thickness_single();
            tint_single();
            var scolor = [
                'color_oakley_black',
                'color_oakley_black_iridium',
                'color_oakley_black_iridium_bar',
                'color_oakley_bronze',
                'color_oakley_bronze_bar',
                'color_oakley_brown_ar',
                'color_oakley_clear_ar',
                'color_oakley_deep_blue',
                'color_oakley_emerald_iridium_bar',
                'color_oakley_fire',
                'color_oakley_g30',
                'color_oakley_gold',
                'color_oakley_gold_iridium',
                'color_oakley_gold_iridium_bar',
                'color_oakley_grey',
                'color_oakley_grey_ar',
                'color_oakley_grey_bar',
                'color_oakley_ice',
                'color_oakley_ice_iridium',
                'color_oakley_oo_black',
                'color_oakley_oo_red_iridium',
                'color_oakley_persimon',
                'color_oakley_shallow_blue',
                'color_oakley_tungsten',
                'color_oakley_vr27_black',
                'color_oakley_vr27_black_iridium',
                'color_oakley_vr28',
                'color_oakley_vr28_bar',
            ];
            var vcolor = [
                "color_oakley_00_red_iridium",
                "color_oakley_bronze_polarised",
                "color_oakley_deep_blue_iridium",
                "color_oakley_g30_iridium",
                "color_oakley_vr28_black_iridium"
            ]; //console.log( array_diff(col, scolor) );
            jQuery.each(vcolor, function(index, value){ jQuery('#'+value).hide(); } ); //hide varifocal colors

            var thickness = jQuery("#lens_thickness input:checked").attr('sku');
            var tint = jQuery("#lens_tint input:checked").attr('sku');

            jQuery("#coating_anti_vf_basic").hide();
            switch(tint){
                case 'tint_full_sv' : 
                    var enable = ['color_oakley_clear_ar','color_oakley_grey','color_oakley_persimon','color_oakley_vr28','color_oakley_bronze'];
                    break;
                case 'tint_iridium_sv' : 
                    var enable = ['color_oakley_black','color_oakley_gold','color_oakley_fire','color_oakley_ice','color_oakley_g30','color_oakley_vr27_black','color_oakley_tungsten'];
                    break;
                case 'tint_polarised_sv' : 
                    var enable = ['color_oakley_grey_bar','color_oakley_bronze_bar','color_oakley_vr28_bar','color_oakley_black_iridium','color_oakley_deep_blue','color_oakley_g30','color_oakley_ice_iridium','color_oakley_gold_iridium','color_oakley_vr27_black_iridium','color_oakley_tungsten','color_oakley_oo_red_iridium','color_oakley_shallow_blue','color_oakley_oo_black'];
                    break;
                case 'tint_transitions_sv' : 
                    var enable = ['color_oakley_grey_ar','color_oakley_brown_ar','color_oakley_black_iridium_bar','color_oakley_gold_iridium_bar','color_oakley_emerald_iridium_bar'];
                    break;
            }
            jQuery.each(enable, function(index, value){ jQuery('#'+value).show(); } );
            jQuery.each( array_diff(scolor,enable), function(index, value){ jQuery('#'+value).hide(); } );
        }
        function varifocal(col){
            varifocal_global();
            thickness_varifocal();
            tint_varifocal();

            var vcolor = [
                'color_oakley_00_red_iridium',
                'color_oakley_black_iridium',
                'color_oakley_black_iridium_bar',
                'color_oakley_bronze_bar',
                'color_oakley_bronze_polarised',
                'color_oakley_brown_ar',
                'color_oakley_deep_blue',
                'color_oakley_deep_blue_iridium',
                'color_oakley_emerald_iridium_bar',
                'color_oakley_g30',
                'color_oakley_g30_iridium',
                'color_oakley_gold_iridium',
                'color_oakley_gold_iridium_bar',
                'color_oakley_grey_ar',
                'color_oakley_grey_bar',
                'color_oakley_ice_iridium',
                'color_oakley_oo_black',
                'color_oakley_oo_red_iridium',
                'color_oakley_shallow_blue',
                'color_oakley_tungsten',
                'color_oakley_vr28_bar',
                'color_oakley_vr28_black_iridium'
            ];
            var scolor = [
                "color_oakley_black",
                "color_oakley_bronze",
                "color_oakley_clear_ar",
                "color_oakley_fire",
                "color_oakley_gold",
                "color_oakley_grey",
                "color_oakley_ice",
                "color_oakley_persimon",
                "color_oakley_vr27_black",
                "color_oakley_vr27_black_iridium",
                "color_oakley_vr28"
            ]; //console.log( array_diff(col, vcolor) );
            jQuery.each(scolor, function(index, value){ jQuery('#'+value).hide(); } ); //hide single colors
            
            jQuery("#coating_anti_vf_basic").hide();

            var varifocal_type = jQuery("#lens_varifocal_type input:checked").attr('sku');
            switch(varifocal_type){
                case 'varifocal_regular' : 
                    var enable = ["color_oakley_grey_ar","color_oakley_brown_ar","color_oakley_black_iridium_bar","color_oakley_gold_iridium_bar","color_oakley_emerald_iridium_bar"];
                    break;
                case 'varifocal_road' : 
                    var enable = ["color_oakley_oo_red_iridium","color_oakley_vr28_black_iridium","color_oakley_black_iridium"];
                    jQuery('#tint_transitions_vf').hide();
                    break;
                case 'varifocal_golf' : 
                    var enable = ["color_oakley_g30","color_oakley_g30_iridium"];
                    jQuery('#tint_transitions_vf').hide();
                    break;
                case 'varifocal_fishing' : 
                    var enable = ["color_oakley_deep_blue_iridium","color_oakley_shallow_blue","color_oakley_bronze_polarised"];
                    jQuery('#tint_transitions_vf').hide();
                    break;
            }
            jQuery.each(enable, function(index, value){ jQuery('#'+value).show(); } );
            jQuery.each( array_diff(vcolor,enable), function(index, value){ jQuery('#'+value).hide(); } );
        }
    }
    //]]>
    </script>
